---
title: "Malware Analysis- Getting Started"
date: 2021-09-27T10:41:07-04:00
draft: false
---

Attacking a big enterprise takes a huge time and planning, and hackers do it so efficiently that it sometimes becomes difficult for the enterprises to cope up with it. Most of the famous attacks that a group of hackers target are malware-based, whose intent is a specific enterprise or group of users to destroy or leak their data. I have mentioned and discussed various security jargon in my previous blog<a href="https://shrutirupa.me/posts/ "> posts </a>,from where you can understand what kind of security aspects an organization should be taking care of and why they are important. Of course, they are just a small number and we always need more, knowing the fact that nothing can be 100% secure.

Moving ahead, we will start with learning some basics of malware analysis. Of course, it is a very vast topic but we will keep learning gradually. So, we will kick off with the basics and the simplest stuff to get our concepts clear. 

Here, we will start with malware-based PDFs and understand how malware gets executed. 

I have used <a href="https://docs.remnux.org/"> Remnux Linux </a>  for analyzing the PDF, you may choose any other Linux-based distro as well, with the required tools installed. 
So, the two most important tools that we are going to use are: 
1. Any text editor like notepad
2. pdfid

There are more tools and applications too and it’s a vast area, but for today, we will just look at the simple things which are:
1. Understanding PDF 
2. Recognizing the suspicious behavior of the PDF

Now first thing first, let us understand what a pdf is.<br>
As described on the internet, pdf is a file format for capturing and sending electronic documents in exactly the intended format independent of application software, hardware, and operating systems.

What does it look like?

<img src="/images/1.PNG" />


A pdf file is often saved with a .pdf extension. But, it is not always necessary that a file saved with a .pdf extension is a pdf file, it may look like a pdf,  but it won’t work like one. <br>
Then how is it understood if a file is of pdf format?  <br>
It’s the syntax that makes all the difference. <br>
A pdf file has its own syntax which is defined in the following way:<br>
<b>Objects:</b> A pdf file has a set of objects which are like dictionaries containing some references to the page’s contents. <br>
<b>File Structure:</b> It defines how the objects mentioned above should be stored and accessed. <br>
<b>Document Structure:</b> It describes the representation of the basic object types and the components of a PDF document. <br>




A PDF file comprises of four components namely: <br>
1.<b>Header</b> - It defines the version number of the PDF specification. Along with the version, we are quite confirmed that it is a pdf file indeed, and not just a file with the “pdf” extension. <br>
2.<b>Body</b>- It contains several objects which include information related to graphics, pages, embedded codes, etc. Objects can be of some types like boolean, strings, streams, dictionaries, arrays, null objects, and a few more.  They can also be labeled to be referenced by other objects. Such labeled objects are often called indirect objects. <br>
3.<b>Cross-reference (xref)</b> -  It defines a table that gives random access to the indirect objects in the body. <br>
4.<b>Trailer</b> - It defines the location of the cross-reference table and some special objects in the body of the pdf. <br>


They all come under the structure of the pdf file. 

<p><b><i>Note:</b> There are two very useful commands that can be used for analysing the type of file and to check the presence of any suspicious strings. They are: <b>file</b> and <b>strings</b> </i></p>
<p>
Usage:
1. <b> file </b> malicious.pdf

<img src="/images/2.PNG" />


2. <b> strings </b> malicious.pdf

<img src="/images/3.PNG" />

<img src="/images/4.PNG" />

</p>

Well!! The strings command gives a lot of information about the pdf.  We can relate the syntax of the PDF with the output of the strings command. <br>
Let’s move ahead to learning some more details :)



While opening a pdf using a text editor, we can see the components more clearly:

<img src="/images/5.PNG" />

<img src="/images/6.PNG" />

We can view the components separately over here. 

Since we have got some basic idea of a pdf document, let’s start with analyzing a malicious one.<br>
When do we call a pdf document a malicious one? What is that one behavior that shows that a pdf file is suspicious?

<p>Let us consider any of the below behavior. <br>
Is it trying to do something that it is not supposed to? <br>
Is it executing some commands?? <br>
Is your system behaving differently after downloading and opening the pdf? <br>
Is your system having some sudden RAM and storage issues?<br>
</p>
Now, how do we understand if the pdf has malware? What do we look for in the pdf? <br>
Attackers make some choices of objects to inject within the document, that are well accepted by the document and also can get executed when the file is opened.<br>
They are JavaScript code, encoded streams, and embedded objects.<br>
These objects not only just get executed in the system but can create network connections with some malicious URLs as well. 


Let us have a look at this:

<img src="/images/7.PNG" />


From the above image, we can comprehend that there can be few tags or objects which may be risky and cause huge damage if ignored.<br>
They are:

 • /OpenAction and /AA: It will execute an action automatically.<br>
 • /JavaScript and /JS: it specifies the script to run which can execute a script(can also open a backdoor). <br>
• /GoTo: changes the view to a specific destination or a document within the document. <br>
• /Launch: used to open a document or start/initiate a program. <br>
• /URI: fetches a URL. <br>
 • /SubmitForm and /GoToR:  posts data to the given URL. <br>
 • /RichMedia: embeds Flash in the document. <br>
 • /ObjStm: Hides an Object Stream. <br>

<i>Pdf tags are used to arrange the document into a hierarchical structure.</i><br>

From above, we can understand that one can embed some malicious script very easily using /JavaScript or /JS. Also if there is an action that needs to be executed first, can be embedded as well. A malicious user can make use of all these options to embed their code, which when launched at first, while opening a pdf, can get executed.
<p>
While concluding, we can understand that it’s not that difficult to check and analyze a pdf document, we just need to be aware of the structure. Testing a malicious pdf or any software, that case, should be done in a sandboxed environment and not on the host machine. Of course, there are plenty of other ways and plenty of other very dangerous software which we will be analyzing later. For now, this is just a beginner’s way to understand how to start with analyzing any kind of malicious software or file, and we chose a pdf one. 

</p>

<p>

<b><u>References:</u></b>
<p> <a href="https://scholarworks.sjsu.edu/cgi/viewcontent.cgi?article=1683&context=etd_projects"> Malware Analysis on PDF</a>  </p>
<p> <a href="http://what-when-how.com/itext-5/understanding-the-carousel-object-system-itext-5/"> Understanding Carousal Object System</a> </p>
<p> <a href="https://blog.idrsolutions.com/2011/05/understanding-the-pdf-file-format-%E2%80%93-pdf-xref-tables-explained/"> Understanding PDF Format</a> </p>

</p>	